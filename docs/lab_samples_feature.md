# Функциональность управления образцами в модуле лаборатории

## Обзор

Добавлена новая функциональность для управления образцами в модуле лаборатории ЦЗЛ. Теперь система позволяет:

1. **Создавать и управлять образцами** для каждой заявки на пробы
2. **Выбирать конкретные образцы** для проведения испытаний
3. **Отслеживать статус** каждого образца отдельно
4. **Сохранять фотографии** образцов

## Новые модели данных

### Sample (Образец)
- `sample_code` - уникальный код образца
- `sample_type` - тип образца (растяжение, удар, химия и т.д.)
- `length`, `width`, `thickness`, `diameter` - размеры образца
- `location_description` - место отбора пробы
- `status` - статус образца (создан, подготовлен, испытывается, испытан, в архиве)
- `photo_path` - путь к фотографии образца

### LabTestSample (Связь испытание-образец)
- Связующая таблица между испытаниями и образцами
- Позволяет использовать несколько образцов в одном испытании
- Сохраняет индивидуальные результаты для каждого образца

## Как использовать

### 1. Управление образцами из заявки на пробы

1. Откройте вкладку "Заявки на пробы" в модуле лаборатории
2. Дважды щелкните по заявке
3. Нажмите кнопку "Управление образцами"
4. В открывшемся диалоге вы можете:
   - **Добавить образец** - создать новый образец вручную
   - **Генерировать коды** - автоматически создать несколько образцов с уникальными кодами
   - **Импорт фото** - добавить фотографии к выбранным образцам
   - Редактировать существующие образцы (двойной щелчок по строке)

### 2. Выбор образцов для испытания

1. При создании нового испытания в разделе "Результаты испытаний"
2. В форме испытания появится таблица "Образцы для испытания"
3. Отметьте галочками образцы, которые будут использованы в данном испытании
4. Система автоматически покажет только подготовленные образцы

### 3. Статусы образцов

- **Создан** - образец зарегистрирован в системе
- **Подготовлен** - образец готов к испытаниям
- **Испытывается** - образец используется в активном испытании
- **Испытан** - испытания завершены
- **В архиве** - образец помещен в архив

## Примеры кодов образцов

Система автоматически генерирует коды в формате:
```
[Марка материала]_[Номер плавки]_[ID заявки]_[Порядковый номер]
```

Пример: `08Х18Н10Т_П123_45_1`

## Миграция базы данных

При первом запуске после обновления система автоматически создаст новые таблицы:
- `samples` - для хранения информации об образцах
- `lab_test_samples` - для связи образцов с испытаниями

## Безопасность

- Только пользователи с ролью "lab" могут управлять образцами
- Код образца нельзя изменить после создания
- Все действия логируются с указанием пользователя и времени 