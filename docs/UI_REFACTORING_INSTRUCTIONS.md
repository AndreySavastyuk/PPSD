# Инструкция для ИИ-агента: Рефакторинг UI проекта PPSD (PySide6)

## 1. Основные задачи:

* Исправить баги с масштабированием таблиц и кнопок (особенно на High-DPI и при изменении размера окна).
* Вынести все стили и оформление в отдельные QSS-файлы (тёмная и светлая темы).
* Убрать фиксированные размеры виджетов, реализовать гибкие Layout-ы.
* Переработать главную страницу приложения, используя один из предложенных UX-паттернов.

---

## 2. Проблемы, которые нужно устранить:

* В коде используются методы `setFixedWidth`, `setFixedHeight`, фиксированные значения размеров для кнопок и таблиц.
* Столбцы таблиц не растягиваются при изменении размера окна (`QTableView`, `QTableWidget`).
* Встречаются устаревшие атрибуты масштабирования из Qt5, например `AA_EnableHighDpiScaling`.
* Стилизация реализована внутри Python-файлов, а не в отдельных QSS.
* Нет централизованной поддержки тем оформления (dark/light).
* Не используются гибкие Layout-ы и растяжки (QSpacerItem, QSizePolicy.Expanding).
* Нет современного UI-дизайна для главной страницы.

---

## 3. ЧТО СДЕЛАТЬ (алгоритм для Cursor Agent):

### A. Исправить масштабирование

* Заменить все `setFixedWidth`, `setFixedHeight`, `setMaximumWidth`, `setMaximumHeight` на:

  ```python
  widget.setSizePolicy(QSizePolicy.Expanding, QSizePolicy.Preferred)
  ```
* Для таблиц добавить:

  ```python
  table.horizontalHeader().setSectionResizeMode(QHeaderView.Stretch)
  ```
* Проверить отсутствие устаревших атрибутов масштабирования (`AA_EnableHighDpiScaling` и др.).

### B. Вынести стили

* Создать директорию `resources/styles/` и добавить два QSS-файла: `dark.qss` и `light.qss`.
* Применять стиль через:

  ```python
  with open("resources/styles/dark.qss") as f:
      app.setStyleSheet(f.read())
  ```
* Все основные параметры (цвета, размеры, отступы) выносить в QSS. Использовать только SVG-иконки.

### C. Переписать компоновку

* Удалить фиксированные layout-ы, добавить гибкие Layout-ы (`QHBoxLayout`, `QVBoxLayout`, `QGridLayout` с растяжками).
* Для выравнивания использовать `QSpacerItem` вместо пустых `QLabel`.
* Везде где это уместно использовать `QSplitter` для разделения областей.

### D. Переработать главную страницу

* Реализовать одну из трёх концепций:

  1. **Dashboard**: 4 большие карточки-модуля (Приёмка, Склад, Лаборатория, Отчёты), вверху индикаторы.
  2. **Sidebar**: Слева меню с иконками (QListWidget), справа основная зона (QStackedWidget) с разными экранами.
  3. **Ribbon/Tabs**: Вкладки в верхней части, внутри каждой — отдельный toolbar и контент, разделённый через `QSplitter`.
* Выбрать подходящий вариант на своё усмотрение и реализовать его.

### E. Добавить переключение темы оформления

* Реализовать функцию/меню для смены стиля (dark/light).

---

## 4. Критерии готовности (чек-лист):

* ✅ Интерфейс не ломается и не плывёт на любом DPI и при изменении размера окна.
* ✅ Все стили подключаются через QSS-файлы.
* ✅ Таблицы автоматически растягиваются, скролл минимален.
* ✅ Главная страница оформлена по выбранному современному UX-паттерну.
* ✅ Легко переключается светлая/тёмная тема.
* ✅ Нет фиксированных размеров для основных элементов (таблицы, кнопки, поля).

---

## 5. Структура проекта для работы:

### Основные UI файлы:
- `ui/main_window.py` - главное окно приложения
- `ui/dashboard.py` - главная панель (дашборд)
- `ui/styles.py` - текущие стили (требует рефакторинга)
- `ui/themes.py` - система тем (требует расширения)
- `ui/tabs/` - вкладки приложения (warehouse_tab.py, qc_tab.py, lab_tab.py и др.)
- `ui/dialogs/` - диалоговые окна
- `ui/components/` - переиспользуемые компоненты

### Файлы для создания:
- `resources/styles/dark.qss` - тёмная тема
- `resources/styles/light.qss` - светлая тема
- `resources/icons/` - SVG иконки (если нужно)

---

## 6. Примеры кода для рефакторинга:

### Пример гибкой таблицы:
```python
# Вместо фиксированных размеров
table.setFixedWidth(800)  # ❌ Убрать

# Использовать гибкие настройки
table.setSizePolicy(QSizePolicy.Expanding, QSizePolicy.Expanding)  # ✅
table.horizontalHeader().setSectionResizeMode(QHeaderView.Stretch)  # ✅
table.horizontalHeader().setStretchLastSection(True)  # ✅
```

### Пример layout с растяжками:
```python
# Добавить растяжки для центрирования
layout = QHBoxLayout()
layout.addStretch()  # Левая растяжка
layout.addWidget(central_widget)
layout.addStretch()  # Правая растяжка
```

### Пример применения QSS:
```python
# Вместо inline стилей
button.setStyleSheet("background-color: blue; color: white;")  # ❌

# Использовать QSS файлы
def load_theme(theme_name):
    with open(f"resources/styles/{theme_name}.qss", "r", encoding="utf-8") as f:
        return f.read()

app.setStyleSheet(load_theme("dark"))  # ✅
```

---

**Задача:** Сделай рефакторинг кода и предложи diff/patch или pull-request с изменениями.

**Формат результата:** Чёткие шаги изменений, рекомендации, примеры кода, либо diff для pull-request.

> **Важно:** Работать только с интерфейсной частью (UI/UX, оформление, layout, адаптивность).
> Не изменять бизнес-логику, модели данных или API. 